# Расширенные возможности

В этом разделе описаны продвинутые функции библиотеки PPVijetBankCard для обработки и форматирования данных.

## Обработка транзакций

Модуль `processing.py` предоставляет функции для работы с финансовыми транзакциями: фильтрации, сортировки и форматирования.

### Фильтрация транзакций по состоянию

#### `filter_by_state`

Функция фильтрует список транзакций по значению ключа 'state'.

```python
from src.processing import filter_by_state

# Использование функции
executed_transactions = filter_by_state(transactions, "EXECUTED")
```

**Особенности:**

- Фильтрует транзакции по указанному состоянию
- По умолчанию ищет транзакции со статусом "EXECUTED"
- Безопасно обрабатывает отсутствующие ключи

**Примеры:**

```python
# Фильтрация: оставляем только выполненные транзакции
executed_transactions = filter_by_state(transactions, "EXECUTED")

# Фильтрация: оставляем только ожидающие транзакции
pending_transactions = filter_by_state(transactions, "PENDING")

# Фильтрация: оставляем только отмененные транзакции
canceled_transactions = filter_by_state(transactions, "CANCELED")
```

### Сортировка транзакций по дате

#### `sort_by_date`

Функция сортирует список транзакций по дате.

```python
from src.processing import sort_by_date

# Использование функции
sorted_transactions = sort_by_date(transactions)
```

**Особенности:**

- Сортирует транзакции по дате в формате ISO
- По умолчанию сортирует от новых к старым
- Поддерживает обратный порядок сортировки

**Примеры:**

```python
# Сортировка: располагаем транзакции по дате (от новых к старым)
sorted_transactions = sort_by_date(transactions)

# Сортировка от старых к новым
sorted_asc = sort_by_date(transactions, reverse_order=False)
```

## Генераторы для обработки данных

Модуль `generators` предоставляет эффективные инструменты для работы с большими объемами данных транзакций с помощью генераторов Python.

### Фильтрация транзакций по валюте

#### `filter_by_currency`

Генератор фильтрует транзакции по заданной валюте.

```python
from generators import filter_by_currency

# Использование генератора
usd_transactions = filter_by_currency(transactions, "USD")
for transaction in usd_transactions:
    print(transaction["description"], transaction["operationAmount"]["amount"])
```

**Особенности:**

- Использует генератор для эффективной обработки больших объемов данных
- Фильтрует транзакции по коду валюты
- Поддерживает различные коды валют (USD, EUR, RUB и т.д.)

**Примеры:**

```python
# Фильтрация транзакций по USD
usd_transactions = filter_by_currency(transactions, "USD")
for transaction in usd_transactions:
    print(f"USD транзакция: {transaction['description']}, сумма: {transaction['operationAmount']['amount']}")

# Фильтрация транзакций по EUR
eur_transactions = filter_by_currency(transactions, "EUR")
for transaction in eur_transactions:
    print(f"EUR транзакция: {transaction['description']}, сумма: {transaction['operationAmount']['amount']}")
```

### Получение описаний транзакций

#### `transaction_descriptions`

Генератор возвращает описание каждой операции по очереди.

```python
from generators import transaction_descriptions

# Использование генератора
descriptions = transaction_descriptions(transactions)
for description in descriptions:
    print(description)
```

**Особенности:**

- Использует генератор для эффективного извлечения описаний
- Возвращает только поле "description" из каждой транзакции
- Обрабатывает отсутствующие описания безопасно

**Примеры:**

```python
# Получение всех описаний транзакций
descriptions = transaction_descriptions(transactions)
for i, description in enumerate(descriptions, 1):
    print(f"{i}. {description}")

# Поиск конкретного типа транзакций
descriptions = transaction_descriptions(transactions)
for description in descriptions:
    if "Перевод" in description:
        print(f"Найден перевод: {description}")
```

### Генерация номеров банковских карт

#### `card_number_generator`

Генератор создает номера банковских карт в формате XXXX XXXX XXXX XXXX.

```python
from generators import card_number_generator

# Использование генератора
card_numbers = card_number_generator(1, 5)
for card_number in card_numbers:
    print(card_number)
```

**Особенности:**

- Генерирует номера карт в заданном диапазоне
- Форматирует номера в стандартный вид XXXX XXXX XXXX XXXX
- Поддерживает генерацию до 9999 9999 9999 9999

**Примеры:**

```python
# Генерация номеров карт в заданном диапазоне
card_numbers = card_number_generator(1, 5)
for card_number in card_numbers:
    print(card_number)
# Вывод:
# 0000 0000 0000 0001
# 0000 0000 0000 0002
# 0000 0000 0000 0003
# 0000 0000 0000 0004
# 0000 0000 0000 0005

# Генерация номеров карт в большом диапазоне
card_numbers = card_number_generator(1000, 1005)
for card_number in card_numbers:
    print(card_number)
# Вывод:
# 0000 0000 0000 1000
# 0000 0000 0000 1001
# 0000 0000 0000 1002
# 0000 0000 0000 1003
# 0000 0000 0000 1004
# 0000 0000 0000 1005
```

## Комплексная обработка данных

Библиотека позволяет комбинировать различные функции для комплексной обработки данных.

### Пример комплексной обработки

```python
from src.processing import filter_by_state, sort_by_date
from generators import filter_by_currency, transaction_descriptions
from src.widget import mask_account_card, get_date

# Фильтрация и сортировка транзакций
executed_transactions = filter_by_state(transactions, "EXECUTED")
sorted_transactions = sort_by_date(executed_transactions)

# Фильтрация по валюте с использованием генератора
usd_transactions = filter_by_currency(sorted_transactions, "USD")

# Обработка результатов
for transaction in usd_transactions:
    # Маскирование данных
    masked_from = mask_account_card(transaction.get("from", ""))
    masked_to = mask_account_card(transaction.get("to", ""))

    # Форматирование даты
    formatted_date = get_date(transaction.get("date", ""))

    # Вывод результата
    print(f"{formatted_date} {transaction.get('description', '')}")
    print(f"{masked_from} -> {masked_to}")
    print(f"Сумма: {transaction.get('operationAmount', {}).get('amount', '')} "
          f"{transaction.get('operationAmount', {}).get('currency', {}).get('code', '')}")
    print()
```

Этот пример демонстрирует, как можно комбинировать различные функции библиотеки для комплексной обработки финансовых данных.
