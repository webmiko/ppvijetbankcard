# Декоратор для логирования

## Обзор

Декоратор `log` из модуля `src.decorators` предоставляет удобный способ логирования выполнения функций, их результатов и ошибок. Декоратор может записывать логи как в файл, так и выводить их в консоль.

## Функциональность

- Логирование начала и конца выполнения функции
- Запись успешного выполнения функции
- Обработка и логирование ошибок с детальной информацией
- Гибкая настройка места вывода логов (файл или консоль)
- Специальная обработка ошибки деления на ноль

## Синтаксис

```python
from src.decorators import log

@log(filename="logfile.txt")  # или @log() для использования файла по умолчанию
def my_function(arg1, arg2):
    # код функции
    pass
```

## Параметры

- `filename` (Optional[str]): Имя файла для записи логов. 
  - По умолчанию: `"logfile.txt"`
  - Если передано `None` или пустая строка, логи выводятся в консоль

## Примеры использования

### Логирование в файл по умолчанию

```python
@log()
def add_numbers(a, b):
    return a + b

result = add_numbers(5, 3)  # Запишет в logfile.txt: "add_numbers ok"
```

### Логирование в указанный файл

```python
@log(filename="my_app.log")
def divide_numbers(a, b):
    return a / b

result = divide_numbers(10, 2)  # Запишет в my_app.log: "divide_numbers ok"
```

### Логирование в консоль

```python
@log(filename=None)  # или @log(filename="")
def multiply_numbers(a, b):
    return a * b

result = multiply_numbers(4, 3)  # Выведет в консоль: "multiply_numbers ok"
```

### Обработка ошибок

```python
@log(filename="errors.log")
def risky_operation(x):
    return 10 / x

try:
    result = risky_operation(0)  # Запишет в errors.log: "risky_operation error: ZeroDivisionError. Деление на ноль невозможно! Inputs: (0,), {}"
except ZeroDivisionError:
    pass
```

## Формат логов

### Успешное выполнение
```
<имя_функции> ok
```

### Ошибка выполнения
```
<имя_функции> error: <тип_ошибки>. <сообщение_об_ошибке> Inputs: <аргументы>, <именованные_аргументы>
```

Для ошибки деления на ноль добавляется специальное сообщение:
```
<имя_функции> error: ZeroDivisionError. Деление на ноль невозможно! Inputs: <аргументы>, <именованные_аргументы>
```

## Особенности реализации

- Декоратор использует менеджер контекста для корректной работы с файлами
- При выводе в консоль используется `sys.stdout` с принудительным сбросом буфера
- Ошибки перехватываются, логируются, а затем повторно вызываются для сохранения стандартного поведения
- Файлы логов открываются в режиме добавления (`"a"`) с кодировкой UTF-8

## Тестирование

Для тестирования декоратора используются модули:

- `tests/test_decorators.py` - базовые тесты
- `tests/test_decorators_fixtures.py` - параметризованные тесты с использованием фикстур

Тесты проверяют:

- Логирование в файл и в консоль
- Корректную обработку различных типов ошибок
- Правильное форматирование сообщений об ошибках
- Работу с различными типами функций и аргументов
