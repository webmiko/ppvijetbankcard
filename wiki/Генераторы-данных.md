# Генераторы данных

В этом разделе подробно описаны функции-генераторы из модуля `generators.py` 
для эффективной обработки данных транзакций.

## Обзор модуля generators

Модуль `generators.py` предоставляет эффективные инструменты для работы с большими объемами данных транзакций с помощью
генераторов Python. Эти генераторы позволяют финансовым аналитикам быстро и удобно находить нужную информацию 
о транзакциях и проводить анализ данных.

## Преимущества использования генераторов

- **Эффективное использование памяти** - генераторы обрабатывают данные "лениво", не загружая все данные в память
- **Высокая производительность** - обработка начинается немедленно, без ожидания полной загрузки данных
- **Цепочки обработки** - генераторы можно комбинировать для создания сложных конвейеров обработки данных

## Функции-генераторы

### filter_by_currency

Генератор `filter_by_currency` фильтрует транзакции по заданной валюте.

#### Синтаксис

```python
def filter_by_currency(transactions: List[Dict[str, Any]], currency_code: str) -> Iterator[Dict[str, Any]]
```

#### Параметры

- `transactions`: Список словарей с транзакциями
- `currency_code`: Код валюты для фильтрации (например, "USD")

#### Возвращаемое значение

Итератор, который возвращает словари транзакций, у которых валюта соответствует заданной.

#### Примеры использования

```python
from generators import filter_by_currency

# Фильтрация транзакций по USD
usd_transactions = filter_by_currency(transactions, "USD")
for transaction in usd_transactions:
    print(transaction["description"], transaction["operationAmount"]["amount"])

# Фильтрация транзакций по EUR
eur_transactions = filter_by_currency(transactions, "EUR")
for transaction in eur_transactions:
    print(f"EUR транзакция: {transaction['description']}, сумма: {transaction['operationAmount']['amount']}")
```

#### Особенности реализации

- Использует безопасный доступ к вложенным словарям через метод `.get()`
- Эффективно обрабатывает большие объемы данных благодаря "ленивой" обработке
- Не создает новый список, а возвращает итератор для экономии памяти

### transaction_descriptions

Генератор `transaction_descriptions` возвращает описание каждой операции по очереди.

#### Синтаксис

```python
def transaction_descriptions(transactions: List[Dict[str, Any]]) -> Iterator[str]
```

#### Параметры

- `transactions`: Список словарей с транзакциями

#### Возвращаемое значение

Итератор, который возвращает описание операции из каждой транзакции.

#### Примеры использования

```python
from generators import transaction_descriptions

# Получение всех описаний транзакций
descriptions = transaction_descriptions(transactions)
for description in descriptions:
    print(description)

# Поиск конкретного типа транзакций
descriptions = transaction_descriptions(transactions)
for description in descriptions:
    if "Перевод" in description:
        print(f"Найден перевод: {description}")

# Подсчет количества каждого типа операции
from collections import Counter
descriptions = transaction_descriptions(transactions)
description_counts = Counter(descriptions)
for desc, count in description_counts.items():
    print(f"{desc}: {count}")
```

#### Особенности реализации

- Безопасно обрабатывает отсутствующие описания через метод `.get()`
- Возвращает только поле "description" из каждой транзакции
- Позволяет эффективно работать с большими объемами данных

### card_number_generator

Генератор `card_number_generator` создает номера банковских карт в формате XXXX XXXX XXXX XXXX.

#### Синтаксис

```python
def card_number_generator(start: int, end: int) -> Iterator[str]
```

#### Параметры

- `start`: Начальное значение для генерации
- `end`: Конечное значение для генерации

#### Возвращаемое значение

Итератор, который возвращает отформатированные номера карт.

#### Примеры использования

```python
from generators import card_number_generator

# Генерация номеров карт в заданном диапазоне
card_numbers = card_number_generator(1, 5)
for card_number in card_numbers:
    print(card_number)
# Вывод:
# 0000 0000 0000 0001
# 0000 0000 0000 0002
# 0000 0000 0000 0003
# 0000 0000 0000 0004
# 0000 0000 0000 0005

# Генерация номеров карт в большом диапазоне
card_numbers = card_number_generator(1000, 1005)
for card_number in card_numbers:
    print(card_number)
# Вывод:
# 0000 0000 0000 1000
# 0000 0000 0000 1001
# 0000 0000 0000 1002
# 0000 0000 0000 1003
# 0000 0000 0000 1004
# 0000 0000 0000 1005

# Создание списка номеров карт
card_list = list(card_number_generator(1, 10))
print(f"Сгенерировано {len(card_list)} номеров карт")
```

#### Особенности реализации

- Форматирует числа в 16-значную строку с ведущими нулями
- Разделяет номер на группы по 4 цифры с пробелами
- Поддерживает генерацию до 9999 9999 9999 9999

## Комплексное использование генераторов

### Пример 1: Анализ транзакций по разным валютам

```python
from generators import filter_by_currency, transaction_descriptions

# Анализ USD транзакций
usd_transactions = filter_by_currency(transactions, "USD")
usd_descriptions = transaction_descriptions(list(usd_transactions))

print("Типы USD транзакций:")
for desc in set(usd_descriptions):
    print(f"- {desc}")

# Анализ EUR транзакций
eur_transactions = filter_by_currency(transactions, "EUR")
eur_descriptions = transaction_descriptions(list(eur_transactions))

print("
Типы EUR транзакций:")
for desc in set(eur_descriptions):
    print(f"- {desc}")
```

### Пример 2: Создание тестовых данных

```python
from generators import card_number_generator
from src.masks import get_mask_card_number

# Создание тестовых номеров карт
test_cards = list(card_number_generator(1001, 1010))

# Маскирование тестовых номеров
masked_cards = [get_mask_card_number(card) for card in test_cards]

# Вывод результатов
print("Тестовые номера карт и их маски:")
for card, masked in zip(test_cards, masked_cards):
    print(f"{card} -> {masked}")
```

### Пример 3: Комплексная обработка с цепочками генераторов

```python
from generators import filter_by_currency, transaction_descriptions
from src.processing import filter_by_state, sort_by_date
from src.widget import mask_account_card, get_date

# Создание конвейера обработки данных
executed_transactions = filter_by_state(transactions, "EXECUTED")
sorted_transactions = sort_by_date(list(executed_transactions))
usd_transactions = list(filter_by_currency(sorted_transactions, "USD"))

# Обработка результатов
for transaction in usd_transactions[:5]:  # Ограничиваем вывод 5 транзакциями
    # Маскирование данных
    from_account = mask_account_card(transaction.get("from", ""))
    to_account = mask_account_card(transaction.get("to", ""))

    # Форматирование даты
    date = get_date(transaction.get("date", ""))

    # Вывод
    print(f"{date} {transaction.get('description', '')}")
    print(f"{from_account} -> {to_account}")
    print(f"Сумма: {transaction.get('operationAmount', {}).get('amount', '')} USD")
    print()
```

## Рекомендации по использованию

1. **Используйте генераторы для больших объемов данных** - это сэкономит память и повысит производительность
2. **Комбинируйте генераторы** - создавайте цепочки обработки для сложных задач
3. **Преобразуйте генераторы в списки только при необходимости** - если вам нужно несколько раз проходить по данным
4. **Используйте генераторы для создания тестовых данных** - это упростит тестирование вашего кода
