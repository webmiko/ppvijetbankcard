# Тестирование

В этом разделе подробно описана система тестирования проекта PPVijetBankCard.

## Обзор системы тестирования

Проект использует фреймворк pytest для тестирования всех компонентов библиотеки. Тесты разделены на несколько категорий:

- Базовые тесты функций
- Параметризованные тесты с использованием фикстур
- Тесты для проверки обработки ошибок
- Интеграционные тесты

## Структура тестов

```
tests/
├── __init__.py
├── conftest.py              # Общие фикстуры для тестов
├── test_masks.py             # Базовые тесты функций маскировки
├── test_masks_fixtures.py    # Параметризованные тесты маскировки
├── test_processing.py        # Тесты функций обработки транзакций
├── test_processing_fixtures.py  # Параметризованные тесты обработки
├── test_widget.py            # Тесты форматирования данных и дат
├── test_widget_fixtures.py   # Параметризованные тесты форматирования
├── test_generators.py        # Тесты функций-генераторов
└── test_generators_fixtures.py  # Параметризованные тесты генераторов
```

## Запуск тестов

### Базовые команды

```bash
# Запуск всех тестов
pytest

# Запуск тестов с выводом покрытия
pytest --cov=src

# Запуск конкретного тестового файла
pytest tests/test_masks.py

# Запуск тестов с генерацией HTML-отчета о покрытии
coverage run -m pytest
coverage html
```

### Дополнительные опции

```bash
# Запуск с подробным выводом
pytest -v

# Запуск только тестов с определенным маркером
pytest -m "unit"

# Запуск тестов с остановкой при первой ошибке
pytest -x

# Запуск тестов с выводом только неудачных тестов
pytest --lf

# Запуск тестов с параллельным выполнением (требуется pytest-xdist)
pytest -n auto
```

## Тестирование функций маскировки

### Базовые тесты (test_masks.py)

В этом файле содержатся тесты для проверки базовых функций маскировки:

- `test_get_mask_card_number` - тест маскировки номеров карт
- `test_get_mask_account` - тест маскировки номеров счетов

### Параметризованные тесты (test_masks_fixtures.py)

В этом файле содержатся параметризованные тесты для проверки различных сценариев маскировки:

- `test_mask_card_number_various_lengths` - тест маскировки карт разной длины
- `test_mask_account_various_lengths` - тест маскировки счетов разной длины
- `test_mask_card_number_invalid` - тест обработки неверных данных

## Тестирование функций форматирования

### Базовые тесты (test_widget.py)

В этом файле содержатся тесты для проверки функций форматирования:

- `test_mask_account_card` - тест умной маскировки карт и счетов
- `test_get_date` - тест форматирования дат

### Параметризованные тесты (test_widget_fixtures.py)

В этом файле содержатся параметризованные тесты для проверки различных сценариев форматирования:

- `test_mask_account_card_various_formats` - тест маскировки различных форматов
- `test_get_date_various_formats` - тест форматирования различных форматов дат
- `test_get_date_invalid_formats` - тест обработки неверных форматов дат

## Тестирование функций обработки

### Базовые тесты (test_processing.py)

В этом файле содержатся тесты для проверки функций обработки транзакций:

- `test_filter_by_state` - тест фильтрации по состоянию
- `test_sort_by_date` - тест сортировки по дате

### Параметризованные тесты (test_processing_fixtures.py)

В этом файле содержатся параметризованные тесты для проверки различных сценариев обработки:

- `test_filter_by_state_various_states` - тест фильтрации по различным состояниям
- `test_sort_by_date_various_orders` - тест сортировки в разном порядке
- `test_filter_by_state_empty_list` - тест обработки пустого списка

## Тестирование генераторов

### Базовые тесты (test_generators.py)

В этом файле содержатся тесты для проверки функций-генераторов:

- `test_filter_by_currency` - тест фильтрации по валюте
- `test_transaction_descriptions` - тест получения описаний транзакций
- `test_card_number_generator` - тест генерации номеров карт

### Параметризованные тесты (test_generators_fixtures.py)

В этом файле содержатся параметризованные тесты для проверки различных сценариев работы генераторов:

- `test_filter_by_currency_various_currencies` - тест фильтрации по различным валютам
- `test_card_number_generator_various_ranges` - тест генерации в различных диапазонах
- `test_card_number_generator_large_range` - тест генерации в большом диапазоне

## Фикстуры

Фикстуры определены в файле `conftest.py` и используются в параметризованных тестах:

- `card_numbers` - набор номеров карт для тестирования
- `account_numbers` - набор номеров счетов для тестирования
- `date_strings` - набор строк с датами для тестирования
- `transactions` - набор транзакций для тестирования
- `currency_codes` - набор кодов валют для тестирования

## Покрытие кода

Проект стремится к 100% покрытию кода тестами. Текущее покрытие:

- `src/masks.py`: 100%
- `src/processing.py`: 100%
- `src/widget.py`: 100%

### Генерация отчета о покрытии

```bash
# Запуск тестов с покрытием
coverage run -m pytest

# Генерация HTML-отчета
coverage html

# Просмотр отчета
open htmlcov/index.html
```

## Написание новых тестов

### Структура теста

```python
def test_function_name():
    """Описание теста."""
    # Подготовка данных
    input_data = ...
    expected_output = ...

    # Выполнение функции
    result = function_under_test(input_data)

    # Проверка результата
    assert result == expected_output
```

### Параметризованный тест

```python
import pytest

@pytest.mark.parametrize("input_data, expected_output", [
    ("data1", "result1"),
    ("data2", "result2"),
    ("data3", "result3")
])
def test_function_with_params(input_data, expected_output):
    """Описание параметризованного теста."""
    # Выполнение функции
    result = function_under_test(input_data)

    # Проверка результата
    assert result == expected_output
```

### Тест с использованием фикстуры

```python
def test_function_with_fixture(card_numbers):
    """Описание теста с использованием фикстуры."""
    # Использование данных из фикстуры
    for card_number in card_numbers:
        result = function_under_test(card_number)
        assert result is not None
```

## Рекомендации по тестированию

1. **Тестируйте все публичные функции** - каждая функция должна иметь тесты
2. **Проверяйте крайние случаи** - пустые строки, нулевые значения, неверные данные
3. **Используйте параметризованные тесты** для проверки множества сценариев
4. **Создавайте осмысленные фикстуры** для повторного использования данных
5. **Стремитесь к 100% покрытию** кода тестами
6. **Пишите понятные описания** для каждого теста
7. **Изолируйте тесты** друг от друга - тесты не должны зависеть от порядка выполнения
